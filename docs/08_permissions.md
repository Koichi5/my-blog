# 権限設計（ロールとできること）

## ロール

| ロール | 説明 |
|--------|------|
| **admin** | 管理者（開発者）。記事の投稿・編集・削除が可能。 |
| **general** | 一般ユーザー。現状は閲覧のみ。将来は自分の記事の投稿・編集・削除を許可する想定。 |

- `User` は `enum role: { general: 0, admin: 1 }` でロールを持つ。
- 開発者本人は `role: :admin` のユーザーとして運用する。

---

## 現状の権限一覧

| 操作 | 未ログイン | general（一般） | admin（管理者） |
|------|------------|-----------------|-----------------|
| 記事一覧の閲覧 | ○ | ○ | ○ |
| 記事詳細の閲覧 | ○ | ○ | ○ |
| いいね・コメント | ○（ゲスト可） | ○ | ○ |
| **記事の新規投稿** | × | × | ○ |
| **記事の編集** | × | × | ○（自分の記事のみ） |
| **記事の削除** | × | × | ○（自分の記事のみ） |
| コメント削除 | × | × | ○（自分のコメント or 管理者） |

- 編集・削除は「その記事の投稿者」または「管理者」のみ可能。
- 現状は投稿を新規作成できるのが管理者のみのため、実質的に編集・削除も管理者のみ。

---

## 将来の拡張（一般ユーザーの投稿を許可する場合）

- **general** にも「記事の新規投稿」「自分の記事の編集・削除」を許可する。
- 実装方針:
  - `PostsController` の `new` / `create` に対する「管理者のみ」制限を外す（または `general` も許可する条件に変更する）。
  - 編集・削除の `check_authorization`（投稿者 or 管理者）はそのまま利用する。
- ドキュメント: 上記の「現状の権限一覧」表の general 列を更新する。

---

## Admin ユーザーの初期設定・パスワードリセット

Rails コンソールで行います。ターミナルで:

```bash
bin/rails c
```

### 既存ユーザーを Admin にする

メールアドレスが分かるとき:

```ruby
u = User.find_by(email: "あなたのメールアドレス")
u.update!(role: :admin)
```

ユーザー一覧から選ぶとき:

```ruby
User.all.each { |u| puts "#{u.id}: #{u.email} (#{u.name})" }
u = User.find(番号)
u.update!(role: :admin)
```

### パスワードを忘れた場合（リセット）

```ruby
u = User.find_by(email: "あなたのメールアドレス")
u.update!(password: "新しいパスワード", password_confirmation: "新しいパスワード")
```

※ 本番では必ず強めのパスワードにし、変更後は再ログインしてすぐに別のパスワードに変更することを推奨します。

### 新規に Admin ユーザーを作る

サインアップ画面で一度一般ユーザーとして登録したあと、上記「既存ユーザーを Admin にする」で `role: :admin` を設定してください。

---

## 実装の置き場所

- **コントローラ**: `PostsController#ensure_can_create_post` で new/create を管理者のみに制限。
- **ビュー**: `can_create_post?`（新規投稿リンク表示）、`can_manage_post?(post)`（編集・削除リンク表示）で判定。
- 詳細は `app/controllers/posts_controller.rb` と `app/helpers/application_helper.rb` を参照。
